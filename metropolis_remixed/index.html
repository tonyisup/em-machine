
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">

<head>
<link rel="icon" 
      type="image/png" 
      href="img/favico.png" />

	<title>Metropolis Remixed</title>
	<link href="css/dark-hive/jquery-ui-1.10.3.custom.css" rel="stylesheet">
	<script src="booklet/jquery-1.7.2.min.js" type="text/javascript"></script>
	<script src="js/jquery-ui-1.10.3.custom.js"></script>
	<script>
	$(function() {
		$( "#go_button" ).button();
		$("#input_field").keyup(function(event){
    		if(event.keyCode == 13){
        	goClick();
    		}
		});
	});

	</script>

	<link rel="stylesheet" href="css/sc-player-minimal.css" type="text/css" />


	<meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">
	<meta http-equiv="content-language" content="en">
	<meta name="description" content="Metropolis Remixed">
	<meta name="keywords" content="The M Machine, Metropolis, Remixed, OWSLA, Skrillex, Kill The Noise, Digitalism, Robotaki, Shinichi Osawa, Tantrum Desire, Matt Lange, Proxy, Trifonic">
	<meta name="author" content="REZ">
	<meta name="generator" content="REZ">
	<meta name="version" content="2.1">
	<meta name="copyright" content="REZ 2007-2009">
	<meta name="robots" content="all">
	<meta name="viewport" content="width=device-width,user-scalable=0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
	<style type="text/css">
	body  {margin:0;padding:0;background-color:#000000;overflow:hidden;font: 62.5% "Trebuchet MS", sans-serif;}
	</style>



</head>


<script type="text/javascript">
function $i(id) { return document.getElementById(id); }
function $r(parent,child) { (document.getElementById(parent)).removeChild(document.getElementById(child)); }
function $t(name) { return document.getElementsByTagName(name); }
function $c(code) { return String.fromCharCode(code); }
function $h(value) { return ('0'+Math.max(0,Math.min(255,Math.round(value))).toString(16)).slice(-2); }
function _i(id,value) { $t('div')[id].innerHTML+=value; }
function _h(value) { return !hires?value:Math.round(value/2); }


function get_screen_size()
	{
	var w=document.documentElement.clientWidth;
	var h=document.documentElement.clientHeight;
	return Array(w,h);
	}

var url=document.location.href;

var flag=true;
var test=true;
var n=500;
var w=0;
var h=0;
var x=0;
var y=0;
var z=0;
var star_color_ratio=0;
var star_x_save,star_y_save;
var star_ratio=100;
var star_speed=4;
var star_speed_save=0;
var star=new Array(n);
var color;
var opacity=0.5;

var cursor_x=0;
var cursor_y=0;
var mouse_x=0;
var mouse_y=0;

var canvas_x=0;
var canvas_y=0;
var canvas_w=0;
var canvas_h=0;
var context_stars;
var context_fore;

var key;
var ctrl;

var timeout;
var fps=0;
var album_art_1 = new Image();
var album_art_2 = new Image();
var overlay_art = new Image();

var sourceX = 0;
var sourceY = 0;
var sourceWidth = 0;
var sourceHeight = 0;
var destWidth = 0;
var destHeight = 0;
var destX = 0;
var destY = 0;
var scale = 0;
var warp = 0;
var warp_percent = 0;

var warp_up = 0;
var warp_down = 0;
var warp_up_time = 1.5;
var warp_down_time = 3;
var opacity_min = .1;
var opacity_max = .5;
var speed_min = 2;
var speed_max = 70; 

var fadestars = 0;
var fadeincrement = .001;

var track = 0;
var overlay_fade = 0;
var overlay_img = "img/Data_Palace.png";
var fade_action = "none";
var fade_count = 0;

var overlay_time = 0;
var current_track = 0;
var sc_fade = 1;
	
var shadow_center_x = 300
var shadow_center_y = 300;
var shadow_radius = 145;

var soundcloud_fade = 1;
var images = {};


      function loadImages(sources, callback) {

        var loadedImages = 0;
        var numImages = 0;
        // get num of sources
        for(var src in sources) {
          numImages++;
        }
        for(var src in sources) {
          images[src] = new Image();
          images[src].onload = function() {
            if(++loadedImages >= numImages) {
              callback(images);
            }
          };
          images[src].src = sources[src];
        }
      }

      var sources = {
        piece1: 'img/Metropolis_Remixed_(1500x1500)_1.png',
        piece2: 'img/Metropolis_Remixed_(1500x1500)_2.png'
      };

      loadImages(sources, function(images) {
			init();
      });








function init()
	{
	var a=0;
	for(var i=0;i<n;i++)
		{
		star[i]=new Array(5);
		star[i][0]=Math.random()*w*2-x*2;
		star[i][1]=Math.random()*h*2-y*2;
		star[i][2]=Math.round(Math.random()*z);
		star[i][3]=0;
		star[i][4]=0;
		star[i][5]=Math.round(Math.random()*100);
		}
	var starfield=$i('starfield');
	starfield.style.position='absolute';
	starfield.width=w;
	starfield.height=h;

	context_stars=starfield.getContext('2d');
	context_stars.fillStyle='rgb(0,0,0)';
	context_stars.strokeStyle='rgb(255,255,255)';

	var foreground = $i('foreground');
	foreground.style.position='absolute';
	foreground.width=w;
	foreground.height=h;

	context_fore=foreground.getContext('2d');
	context_fore.fillStyle='rgba(255,0,0,.5)';
	context_fore.clearRect(0,0,w,h);

	var overlay = $i('overlay');
	overlay.style.position='absolute';
	overlay.width=w;
	overlay.height=h;

	context_overlay=overlay.getContext('2d');
	context_overlay.fillStyle='rgba(255,0,0,.5)';
	context_overlay.clearRect(0,0,w,h);

	var input = $i('input_coordinates');
	input.style.position = 'absolute';
	input.style.top = h*.9 + "px";
	input.style.left = w/2 - 70 + "px";

	var sc_div = $i('soundcloud');
	sc_div.style.position = 'absolute';
	sc_div.style.top = h*.75 + "px";
	sc_div.style.left = w/2 - 250 + "px";

	var shadow = $i('shadow');
	var shadow_gif = $i('shadowgif');

	draw_overlays();

	}

function anim()
	{
	mouse_x=cursor_x-x;
	mouse_y=cursor_y-y;



	if (warp > 0) {
		if (warp == 1) {
			warp_up += .02;
			warp_percent = warp_up / warp_up_time;
			opacity = opacity_max - ((opacity_max - opacity_min) * warp_percent);
			star_speed = speed_min + ((speed_max - speed_min) * warp_percent);

			if (overlay_fade > 0) {
					overlay_fade = 1 - warp_percent;
					draw_overlays();			
			}


			if (warp_up >= warp_up_time) {
				overlay_fade = 0;
				warp_up = 0;
				warp = 2;
				get_coordinates();
			}

		}
		if (warp == 2){
			warp_down += .02;
			warp_percent = (1 - warp_down / warp_down_time);
			opacity = opacity_max - ((opacity_max - opacity_min) * warp_percent);
			star_speed = speed_min + ((speed_max - speed_min) * warp_percent);


			if (warp_down >= warp_down_time) {
				warp_down = 0;
				warp = 0;
				fade_action = "in";
			}
		}
	}

	else {
		opacity = opacity_max;
		star_speed = speed_min;
	}


	context_stars.fillRect(0,0,w,h);
	context_stars.fillStyle='rgba(0,0,0,'+opacity+')';

	
	for(var i=0;i<n;i++)
		{
		test=true;
		star_x_save=star[i][3];
		star_y_save=star[i][4];
		star[i][0]+=mouse_x>>4; if(star[i][0]>x<<1) { star[i][0]-=w<<1; test=false; } if(star[i][0]<-x<<1) { star[i][0]+=w<<1; test=false; }
		star[i][1]+=mouse_y>>6; if(star[i][1]>y<<1) { star[i][1]-=h<<1; test=false; } if(star[i][1]<-y<<1) { star[i][1]+=h<<1; test=false; }
		star[i][2]-=star_speed; if(star[i][2]>z) { star[i][2]-=z; test=false; } if(star[i][2]<0) { star[i][2]+=z; test=false; }
		star[i][3]=x+(star[i][0]/star[i][2])*star_ratio;
		star[i][4]=y+(star[i][1]/star[i][2])*star_ratio;
		if(star_x_save>0&&star_x_save<w&&star_y_save>0&&star_y_save<h&&test)
			{
			if (star[i][5] >= 90) { context_stars.strokeStyle='rgb(255,0,0)'; }
			if (star[i][5] <90) { context_stars.strokeStyle='rgb(255,255,255)'; }


			context_stars.lineWidth=(1-star_color_ratio*star[i][2])*2;
			context_stars.beginPath();
			context_stars.moveTo(star_x_save,star_y_save);
			context_stars.lineTo(star[i][3],star[i][4]);
			context_stars.stroke();
			context_stars.closePath();
			}
		}

		fade_overlays();
	}


function fade_overlays()
	{

		if (fade_action == "hold") {
			fade_count += .02;

			draw_overlays();

			if (fade_count >= warp_down_time *.75) {
				fade_count = 0;
				fade_action = "out";
			}

		}
		if (fade_action == "in") {
			fade_count += .02;
			overlay_fade = fade_count / warp_up_time;

			draw_overlays();

			if (fade_count >= warp_up_time) {
				fade_count = 0;

				if (track == 0) { fade_action = "hold";}
				else { fade_action = "none";}
			}
		}
		if (fade_action == "out") {
			fade_count += .02;
			overlay_fade = 1 - (fade_count / warp_up_time);

			if (sc_fade == 0) {
				sc_fade = 2;
			}

			draw_overlays();

			if (fade_count >= warp_up_time) {
				fade_count = 0;
				fade_action = "none";
				sc_fade = 1;
			}
		}

	}



function draw_overlays()
	{

	album_art_1 = images.piece1;
	album_art_2 = images.piece2;
	overlay_art.src = overlay_img;


	shadowgif.style.opacity = .3 * overlay_fade;
	context_overlay.globalAlpha= overlay_fade;


	if (sc_fade != 2) {
		var mydiv = document.getElementById("soundcloud");
		mydiv.style.opacity = .7 * overlay_fade;
	}


	if (w >= h) {
		scale = w/album_art_1.width;
			
		sourceX = 0;
		sourceY = (1 - (h/w)) * album_art_1.height / 2; 
		sourceWidth = album_art_1.width;
		sourceHeight = (h/w) * album_art_1.height;
		destWidth = w;
		destHeight = h;
		destX = 0;
		destY = 0;


		shadow_center_x = (562 - sourceX) * scale;
		shadow_center_x -= (shadow_radius * scale);
		shadow_center_y = (608 - sourceY) * scale;
		shadow_center_y -= (shadow_radius * scale);

		shadow.style.top = shadow_center_y + "px";
		shadow.style.left = shadow_center_x + "px";

		shadowgif.style.height = (shadow_radius * 2 * scale)+ "px";
		shadowgif.style.width = (shadow_radius * 2 * scale) + "px";


		context_fore.clearRect(0,0,w,h);
		context_fore.drawImage(album_art_1,sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
		context_fore.drawImage(album_art_2,sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);

		context_overlay.clearRect(0,0,w,h);
		context_overlay.drawImage(overlay_art,sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
	}
	
	if (w < h) {
		scale = h/album_art_1.height;
			
		sourceX = (1 - (w/h)) * album_art_1.width / 2;
		sourceY = 0; 
		sourceWidth = (w/h) * album_art_1.width;
		sourceHeight = album_art_1.height;
		destWidth = w;
		destHeight = h;
		destX = 0;
		destY = 0;

		shadow_center_x = (562 - sourceX) * scale;
		shadow_center_x -= (shadow_radius * scale);
		shadow_center_y = (608 - sourceY) * scale;
		shadow_center_y -= (shadow_radius * scale);

		shadow.style.top = shadow_center_y + "px";
		shadow.style.left = shadow_center_x + "px";

		shadowgif.style.height = (shadow_radius * 2 * scale)+ "px";
		shadowgif.style.width = (shadow_radius * 2 * scale) + "px";

		context_fore.clearRect(0,0,w,h);
		context_fore.drawImage(album_art_1,sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
		context_fore.drawImage(album_art_2,sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);

		context_overlay.clearRect(0,0,w,h);
		context_overlay.drawImage(overlay_art,sourceX, sourceY, sourceWidth, sourceHeight, destX, destY, destWidth, destHeight);
	}
	}




function move(evt)
	{
	evt=evt||event;
	cursor_x=evt.pageX-canvas_x;
	cursor_y=evt.pageY-canvas_y;
	}


function start()
	{
	setInterval(anim, 20);
	resize();
	draw_overlays();
	}


function resize()
	{

	w=parseInt((url.indexOf('w=')!=-1)?url.substring(url.indexOf('w=')+2,((url.substring(url.indexOf('w=')+2,url.length)).indexOf('&')!=-1)?url.indexOf('w=')+2+(url.substring(url.indexOf('w=')+2,url.length)).indexOf('&'):url.length):get_screen_size()[0]);
	h=parseInt((url.indexOf('h=')!=-1)?url.substring(url.indexOf('h=')+2,((url.substring(url.indexOf('h=')+2,url.length)).indexOf('&')!=-1)?url.indexOf('h=')+2+(url.substring(url.indexOf('h=')+2,url.length)).indexOf('&'):url.length):get_screen_size()[1]);

	if (w<640) {
		w=640;
	}	
	if (h<480) {
		h=480;
	}	


	x=Math.round(w/2);
	y=Math.round(h/2);
	z=(w+h)/2;
	star_color_ratio=1/z;
	cursor_x=x;
	cursor_y=y;
	init();
	}

function goClick()
	{
		if (warp == 0) {warp = 1;}
		var elem = document.getElementById("input_field");
		coordinates = elem.value;
	}

function get_coordinates(){
	
	var coords = $('#input_field').val();

	$.ajax({
	dataType: "json",
	type: "POST",
	url: "coordinates.php",
	data: {fcoords:coords}
	}).done(function(returned) {

	if (returned.track == current_track) {
		sc_fade = 0;
	}
	else if (returned.track == 0) {
		sc_fade = 0;
	}
	else {
		sc_fade = 1;
	}


		overlay_img = returned.img;
		track = returned.track;	
		current_track = returned.track;


	if (sc_fade == 1) {
		var mydiv = document.getElementById("soundcloud");
		mydiv.innerHTML = "";

		if (returned.url != "none") {

			var aTag = document.createElement('a');
			aTag.setAttribute('href',returned.url);
			aTag.setAttribute('class',"sc-player");
			aTag.innerHTML = "SONG";
			mydiv.appendChild(aTag);

			$('a.sc-player').scPlayer();
		}
	}


	shadow_radius = returned.radius;
	draw_overlays();

	});
}


document.onmousemove=move;

</script>


<body onload="start()" onresize="resize()" onorientationchange="resize()">
<div id="canvasesdiv" style="position:relative; width:2000px; height:1500px">
<canvas id="starfield" style="z-index: 1"></canvas>
<canvas id="overlay" style="z-index: 2"></canvas>
<canvas id="foreground" style="z-index: 3"></canvas>
</div>


<div id="input_coordinates" style="position: absolute; top:-200px; left:2000px; z-index: 4; width:300px; height:70px; margin:auto;">
<input id="input_field" type="text" placeholder="Input Coordinates" style="width:150px; 
    border-radius:10px; 
    border: solid 1px #ccc; 
    padding:0.4em; 
    background-color: #333333; 
    color: #FFFFFF;
    box-shadow: inset 0 2px 3px rgba(0,0,0,0.2);" />
<button id="go_button" onclick="goClick()">GO</button>
</div>

<div id="shadow" style="position: absolute; top:150px; left:420px; z-index: 2; width:500px; height:500px; margin:auto;">
	<img id ="shadowgif" src="img/shadow.gif" style="opacity: 0.3" height=300 width=300>
</div>

<div align="center" id="soundcloud" style="position: absolute; top:500px; left:500px; z-index: 4; width:500px; height: 50px; margin:auto; opacity:0.7;">
</div>

<script type="text/javascript" src="js/soundcloud.player.api.js"></script>
<script type="text/javascript" src="js/sc-player.js"></script>






</body>




</html>